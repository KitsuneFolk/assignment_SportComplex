## Огляд коду

Цей код реалізує API для управління відвідувачами спорткомплексу з використанням FastAPI, SQLAlchemy та Jinja2. Він складається з кількох файлів:

1.  `database.py`: Містить конфігурацію бази даних, включаючи URL, створення двигуна, сесії та базового класу для моделей.
2.  `index.html`:  HTML-шаблон для інтерфейсу користувача, який дозволяє переглядати, додавати, редагувати та видаляти відвідувачів.  Використовує Bootstrap для стилізації та jQuery для обробки AJAX-запитів.
3.  `main.py`: Основний файл програми FastAPI, що визначає API-кінцеві точки для створення, читання, оновлення та видалення відвідувачів.  Він також відповідає за рендеринг HTML-шаблону.
4.  `schemas.py`:  Визначає Pydantic моделі даних для представлення відвідувачів, включаючи базову модель, модель для створення, модель для оновлення та модель для отримання даних.
5.  `models.py`: Визначає SQLAlchemy модель бази даних для таблиці `visitors`.  Вона включає атрибути для імені, прізвища, дати народження, типу членства, дати реєстрації, статусу активності та електронної пошти.  Також визначено гібридну властивість `full_name` для отримання повного імені відвідувача.

## Детальний опис файлів

### `database.py`

Цей файл відповідає за налаштування з'єднання з базою даних.

*   **Імпорт бібліотек:** Імпортуються необхідні бібліотеки, такі як `os`, `dotenv`, `create_engine`, `declarative_base` та `sessionmaker` з бібліотек `sqlalchemy`.
*   **Завантаження змінних середовища:** Використовується `load_dotenv()` для завантаження змінних середовища з файлу `.env` (якщо він існує).
*   **Визначення URL бази даних:** URL бази даних визначається за допомогою `os.getenv("DATABASE_URL", "sqlite:///./sportcomplex.db")`. Якщо змінна середовища `DATABASE_URL` не встановлена, використовується SQLite база даних за замовчуванням.
*   **Створення двигуна бази даних:** Створюється двигун бази даних за допомогою `create_engine(DATABASE_URL)`.
*   **Створення сесії бази даних:** Створюється фабрика сесій `SessionLocal` за допомогою `sessionmaker`.
*   **Створення базового класу для моделей:** Створюється базовий клас `Base` за допомогою `declarative_base()`, від якого успадковуються всі моделі бази даних.
*   **Функція для отримання сесії бази даних:** Функція `get_db()` використовується як залежність у FastAPI маршрутах для отримання сесії бази даних. Вона забезпечує відкриття та закриття сесії після використання.

### `index.html`

Цей файл містить HTML код для інтерфейсу користувача веб-сторінки.

*   **Структура HTML:** Базова структура HTML документу, включаючи `<head>` та `<body>`.
*   **Підключення CSS:** Підключення Bootstrap CSS для стилізації інтерфейсу.
*   **Заголовки:** Відображення заголовку "Відвідувачі спорткомплексу".
*   **Форма додавання відвідувача:** Форма для додавання нових відвідувачів, що містить поля для імені, прізвища, дати народження, типу членства, дати реєстрації, електронної пошти та статусу активності.
*   **Таблиця відвідувачів:** Таблиця для відображення списку відвідувачів. Дані в таблицю завантажуються динамічно за допомогою JavaScript.
*   **Модальне вікно редагування:** Модальне вікно для редагування інформації про відвідувача.
*   **JavaScript:**
    *   Підключення jQuery та Bootstrap JavaScript.
    *   Функція `loadVisitors()`: Завантажує дані про відвідувачів з API (`/visitors/`) та відображає їх у таблиці.
    *   Обробник події `submit` для форми додавання відвідувача: Відправляє POST запит на API для створення нового відвідувача.
    *   Обробник події `click` для кнопок видалення відвідувача: Відправляє DELETE запит на API для видалення відвідувача.
    *   Обробник події `click` для кнопок редагування відвідувача: Завантажує дані про відвідувача з API та заповнює ними форму редагування.
    *   Обробник події `click` для кнопки збереження змін: Відправляє PUT запит на API для оновлення інформації про відвідувача.

### `main.py`

Цей файл є основним файлом програми FastAPI, який визначає API-кінцеві точки та їхню логіку.

*   **Імпорт бібліотек:** Імпортуються необхідні бібліотеки, такі як `FastAPI`, `Depends`, `HTTPException`, `Session`, `List`, `Optional`, `Query`, `Request`, `HTMLResponse` та `Jinja2Templates`.
*   **Імпорт моделей та схем:** Імпортуються моделі бази даних та схеми Pydantic.
*   **Створення екземпляру FastAPI:** Створюється екземпляр FastAPI за допомогою `app = FastAPI()`.
*   **Налаштування Jinja2 шаблонів:** Налаштовуються Jinja2 шаблони для рендерингу HTML.
*   **Визначення залежності `get_db()`:** Визначається залежність `get_db()` для отримання сесії бази даних.
*   **Визначення маршрутів:**
    *   `GET /`: Рендерить HTML-шаблон `index.html`.
    *   `POST /visitors/`: Створює нового відвідувача в базі даних.
    *   `GET /visitors/{visitor_id}`: Отримує інформацію про відвідувача за його ID.
    *   `GET /visitors/`: Отримує список всіх відвідувачів з можливістю пагінації.
    *   `GET /visitors/search/`:  Здійснює пошук відвідувачів за іменем та прізвищем.
    *   `PUT /visitors/{visitor_id}`: Оновлює інформацію про відвідувача.
    *   `DELETE /visitors/{visitor_id}`: Видаляє відвідувача з бази даних.

### `schemas.py`

Цей файл визначає Pydantic моделі даних для представлення відвідувачів.

*   **`VisitorBase`:** Базова модель, що містить основні атрибути відвідувача (ім'я, прізвище, дата народження, тип членства, дата реєстрації, статус активності та електронна пошта).
*   **`VisitorCreate`:** Модель для створення нового відвідувача, успадкована від `VisitorBase`.
*   **`VisitorUpdate`:** Модель для оновлення інформації про відвідувача, успадкована від `VisitorBase` з усіма атрибутами, позначеними як `Optional`.
*   **`Visitor`:** Модель для отримання даних про відвідувача, успадкована від `VisitorBase` та включає атрибут `id`.
*   **`VisitorSearchResults`:** Модель для представлення результатів пошуку відвідувачів.

### `models.py`

Цей файл визначає SQLAlchemy модель бази даних для таблиці `visitors`.

*   **Імпорт бібліотек:** Імпортуються необхідні бібліотеки, такі як `Column`, `Integer`, `String`, `Date`, `Boolean` та `hybrid_property`.
*   **Визначення моделі `Visitor`:**
    *   `__tablename__ = "visitors"`: Вказує назву таблиці в базі даних.
    *   `id`: Унікальний ідентифікатор відвідувача (первинний ключ).
    *   `first_name`: Ім'я відвідувача.
    *   `last_name`: Прізвище відвідувача.
    *   `date_of_birth`: Дата народження відвідувача.
    *   `membership_type`: Тип членства відвідувача.
    *   `registration_date`: Дата реєстрації відвідувача.
    *   `is_active`: Статус активності відвідувача.
    *   `email`: Електронна пошта відвідувача.
    *   `full_name`: Гібридна властивість для отримання та встановлення повного імені відвідувача.

## Запуск програми

1.  Переконайтеся, що у вас встановлено Python 3.7+ та pip.
2.  Встановіть залежності 'pip install -r requirements.txt'
3.  Перейдiть в директорiю коду: `cd code`
3.  Запустіть код: `uvicorn main:app --reload`